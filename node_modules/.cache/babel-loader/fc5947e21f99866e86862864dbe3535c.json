{"ast":null,"code":"import axios from 'axios';\nexport default {\n  name: 'BusinessInfo',\n\n  data() {\n    return {\n      businessId: this.$route.query.businessId,\n      business: {},\n      foodArr: [],\n      user: {},\n      foodss: []\n    };\n  },\n\n  created() {\n    this.user = this.$getSessionStorage('user'); //根据businessId查询商家信息\n\n    axios.post('BusinessController/getBusinessById', this.$qs.stringify({\n      businessId: this.businessId\n    })).then(response => {\n      this.business = response.data;\n    }).catch(error => {\n      console.error(error);\n    }); //根据businessId查询所属食品信息\n\n    axios.post('FoodController/listFoodByBusinessId', this.$qs.stringify({\n      businessId: this.businessId\n    })).then(response => {\n      this.foodArr = response.data;\n      this.foodss.push(this.foodArr);\n      console.log(this.foodArr);\n\n      for (let i = 0; i < this.foodArr.length; i++) {\n        this.foodArr[i].quantity = 0;\n      } //如果已登录，那么需要去查询购物车中是否已经选购了某个食品\n\n\n      if (this.user != null) {\n        this.listCart();\n      }\n    }).catch(error => {\n      console.error(error);\n    });\n  },\n\n  methods: {\n    listCart() {\n      axios.post('CartController/listCart', this.$qs.stringify({\n        businessId: this.businessId,\n        userId: this.user.userId\n      })).then(response => {\n        let cartArr = response.data; //遍历所有食品列表\n\n        for (let foodItem of this.foodArr) {\n          foodItem.quantity = 0;\n\n          for (let cartItem of cartArr) {\n            if (cartItem.foodId == foodItem.foodId) {\n              foodItem.quantity = cartItem.quantity;\n            }\n          }\n        }\n\n        this.foodArr.sort();\n      }).catch(error => {\n        console.error(error);\n      });\n    },\n\n    add(index) {\n      //首先做登录验证\n      if (this.user == null) {\n        this.$router.push({\n          path: '/login'\n        });\n        return;\n      }\n\n      if (this.foodArr[index].quantity == 0) {\n        //做insert\n        this.savaCart(index);\n      } else {\n        //做update\n        this.updateCart(index, 1);\n      }\n    },\n\n    minus(index) {\n      //首先做登录验证\n      if (this.user == null) {\n        this.$router.push({\n          path: '/login'\n        });\n        return;\n      }\n\n      if (this.foodArr[index].quantity > 1) {\n        //做update\n        this.updateCart(index, -1);\n      } else {\n        //做delete\n        this.removeCart(index);\n      }\n    },\n\n    savaCart(index) {\n      axios.post('CartController/saveCart', this.$qs.stringify({\n        businessId: this.businessId,\n        userId: this.user.userId,\n        foodId: this.foodArr[index].foodId\n      })).then(response => {\n        if (response.data == 1) {\n          //此食品数量要更新为1；\n          this.foodArr[index].quantity = 1;\n          this.foodArr.sort();\n        } else {\n          alert('向购物车中添加食品失败！');\n        }\n      }).catch(error => {\n        console.error(error);\n      });\n    },\n\n    updateCart(index, num) {\n      axios.post('CartController/updateCart', this.$qs.stringify({\n        businessId: this.businessId,\n        userId: this.user.userId,\n        foodId: this.foodArr[index].foodId,\n        quantity: this.foodArr[index].quantity + num\n      })).then(response => {\n        if (response.data == 1) {\n          //此食品数量要更新为1或-1；\n          this.foodArr[index].quantity += num;\n          this.foodArr.sort();\n        } else {\n          alert('向购物车中更新食品失败！');\n        }\n      }).catch(error => {\n        console.error(error);\n      });\n    },\n\n    removeCart(index) {\n      axios.post('CartController/removeCart', this.$qs.stringify({\n        businessId: this.businessId,\n        userId: this.user.userId,\n        foodId: this.foodArr[index].foodId\n      })).then(response => {\n        if (response.data == 1) {\n          //此食品数量要更新为0；视图的减号和数量要消失\n          this.foodArr[index].quantity = 0;\n          this.foodArr.sort();\n        } else {\n          alert('从购物车中删除食品失败！');\n        }\n      }).catch(error => {\n        console.error(error);\n      });\n    },\n\n    toOrder() {\n      this.$router.push({\n        path: '/orders',\n        query: {\n          businessId: this.business.businessId\n        }\n      });\n    }\n\n  },\n  computed: {\n    //食品总价格\n    totalPrice() {\n      let total = 0;\n\n      for (let item of this.foodArr) {\n        total += item.foodPrice * item.quantity;\n      }\n\n      return total;\n    },\n\n    //食品总数量\n    totalQuantity() {\n      let quantity = 0;\n\n      for (let item of this.foodArr) {\n        quantity += item.quantity;\n      }\n\n      return quantity;\n    },\n\n    //结算总价格\n    totalSettle() {\n      return this.totalPrice + this.business.deliveryPrice;\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAqEA;AACA;EACAA,oBADA;;EAEAC;IACA;MACAC,wCADA;MAEAC,YAFA;MAGAC,WAHA;MAIAC,QAJA;MAKAC;IALA;EAOA,CAVA;;EAWAC;IACA,4CADA,CAEA;;IACAC;MACAN;IADA,IAEAO,IAFA,CAEAC;MACA;IACA,CAJA,EAIAC,KAJA,CAIAC;MACAC;IACA,CANA,EAHA,CAUA;;IACAL;MACAN;IADA,IAEAO,IAFA,CAEAC;MACA;MACA;MACAG;;MACA;QACA;MACA,CANA,CAOA;;;MACA;QACA;MACA;IACA,CAbA,EAaAF,KAbA,CAaAC;MACAC;IACA,CAfA;EAgBA,CAtCA;;EAuCAC;IACAC;MACAP;QACAN,2BADA;QAEAc;MAFA,IAGAP,IAHA,CAGAC;QACA,4BADA,CAGA;;QACA;UACAO;;UACA;YACA;cACAA;YACA;UACA;QACA;;QACA;MACA,CAhBA,EAgBAN,KAhBA,CAgBAC;QACAC;MACA,CAlBA;IAmBA,CArBA;;IAsBAK;MACA;MACA;QACA;UACAC;QADA;QAGA;MACA;;MACA;QACA;QACA;MACA,CAHA,MAGA;QACA;QACA;MACA;IACA,CArCA;;IAsCAC;MACA;MACA;QACA;UACAD;QADA;QAGA;MACA;;MACA;QACA;QACA;MACA,CAHA,MAGA;QACA;QACA;MACA;IACA,CArDA;;IAsDAE;MACAb;QACAN,2BADA;QAEAc,wBAFA;QAGAM;MAHA,IAIAb,IAJA,CAIAC;QACA;UACA;UACA;UACA;QACA,CAJA,MAIA;UACAa;QACA;MACA,CAZA,EAYAZ,KAZA,CAYAC;QACAC;MACA,CAdA;IAeA,CAtEA;;IAuEAW;MACAhB;QACAN,2BADA;QAEAc,wBAFA;QAGAM,kCAHA;QAIAG;MAJA,IAKAhB,IALA,CAKAC;QACA;UACA;UACA;UACA;QACA,CAJA,MAIA;UACAa;QACA;MACA,CAbA,EAaAZ,KAbA,CAaAC;QACAC;MACA,CAfA;IAgBA,CAxFA;;IAyFAa;MACAlB;QACAN,2BADA;QAEAc,wBAFA;QAGAM;MAHA,IAIAb,IAJA,CAIAC;QACA;UACA;UACA;UACA;QACA,CAJA,MAIA;UACAa;QACA;MACA,CAZA,EAYAZ,KAZA,CAYAC;QACAC;MACA,CAdA;IAeA,CAzGA;;IA0GAc;MACA;QACAR,eADA;QAEAS;UACA1B;QADA;MAFA;IAMA;;EAjHA,CAvCA;EA0JA2B;IACA;IACAC;MACA;;MACA;QACAC;MACA;;MACA;IACA,CARA;;IASA;IACAC;MACA;;MACA;QACAP;MACA;;MACA;IACA,CAhBA;;IAiBA;IACAQ;MACA;IACA;;EApBA;AA1JA","names":["name","data","businessId","business","foodArr","user","foodss","created","axios","then","response","catch","error","console","methods","listCart","userId","foodItem","add","path","minus","savaCart","foodId","alert","updateCart","quantity","removeCart","toOrder","query","computed","totalPrice","total","totalQuantity","totalSettle"],"sourceRoot":"src/views","sources":["BusinessInfo.vue"],"sourcesContent":["<template>\n  <div class=\"wrapper\">\n    <!-- header部分 -->\n    <header>\n      <div></div>\n      <p>商家信息</p>\n    </header>\n    <!-- 商家logo部分 -->\n    <div class=\"business-logo\">\n      <img :src=\"business.businessImg\">\n    </div>\n    <!-- 商家信息部分 -->\n    <div class=\"business-info\">\n      <h1>{{business.businessName}}</h1>\n      <p>&#165;{{business.starPrice}}起送 &#165;{{business.deliveryPrice}}配送</p>\n      <p>{{business.businessExplain}}</p>\n    </div>\n    <!-- 食品列表部分 -->\n    <ul class=\"food\">\n      <li v-for=\"(item,index) in foodss[0]\" :key=\"index\">\n        <div class=\"food-left\">\n          <img :src=\"item.foodImg\">\n          <div class=\"food-left-info\">\n            <h3>{{item.foodName}}</h3>\n            <p>{{item.foodExplain}}</p>\n            <p>&#165;{{item.foodPrice}}</p>\n          </div>\n        </div>\n        <div class=\"food-right\">\n          <div>\n            <i class=\"fa fa-minus-circle\" @click=\"minus(index)\" v-show=\"item.quantity!=0\"></i>\n          </div>\n          <p><span v-show=\"item.quantity!=0\">{{item.quantity}}</span></p>\n          <div>\n            <i class=\"fa fa-plus-circle\" @click=\"add(index)\"></i>\n          </div>\n        </div>\n      </li>\n      <li style=\"height:16vw\"></li>\n    </ul>\n\n    <!-- 购物车部分 -->\n    <div class=\"cart\">\n      <div class=\"cart-left\">\n        <div class=\"cart-left-icon\" :style=\"totalQuantity==0?'background-color:#505051;':'background-color:#3190E8;'\">\n          <i class=\"fa fa-shopping-cart\"></i>\n          <div class=\"cart-left-icon-quantity\" v-show=\"totalQuantity!=0\">\n            {{totalQuantity}}</div>\n        </div>\n        <div class=\"cart-left-info\">\n          <p>&#165;{{totalPrice}}</p>\n          <p>另需配送费{{business.deliveryPrice}}元</p>\n        </div>\n      </div>\n      <div class=\"cart-right\">\n        <!-- 不够起送费 -->\n        <div class=\"cart-right-item\" v-show=\"totalSettle<business.starPrice\"\n             style=\"background-color: #535356;cursor: default;\">\n          &#165;{{business.starPrice}}起送\n        </div>\n        <!-- 达到起送费 -->\n        <div class=\"cart-right-item\" @click=\"toOrder\" v-show=\"totalSettle>=business.starPrice\">\n          去结算\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport axios from 'axios'\nexport default {\n  name: 'BusinessInfo',\n  data() {\n    return {\n      businessId: this.$route.query.businessId,\n      business: {},\n      foodArr: [],\n      user: {},\n      foodss: [],\n    }\n  },\n  created() {\n    this.user = this.$getSessionStorage('user');\n    //根据businessId查询商家信息\n   axios.post('BusinessController/getBusinessById', this.$qs.stringify({\n      businessId: this.businessId\n    })).then(response => {\n      this.business = response.data;\n    }).catch(error => {\n      console.error(error);\n    });\n    //根据businessId查询所属食品信息\n    axios.post('FoodController/listFoodByBusinessId', this.$qs.stringify({\n      businessId: this.businessId\n    })).then(response => {\n      this.foodArr = response.data;\n      this.foodss.push(this.foodArr);\n      console.log(this.foodArr);\n      for (let i = 0; i < this.foodArr.length; i++) {\n        this.foodArr[i].quantity = 0;\n      }\n      //如果已登录，那么需要去查询购物车中是否已经选购了某个食品\n      if (this.user != null) {\n        this.listCart();\n      }\n    }).catch(error => {\n      console.error(error);\n    });\n  },\n  methods: {\n    listCart() {\n      axios.post('CartController/listCart', this.$qs.stringify({\n        businessId: this.businessId,\n        userId: this.user.userId\n      })).then(response => {\n        let cartArr = response.data;\n        \n        //遍历所有食品列表\n        for (let foodItem of this.foodArr) {\n          foodItem.quantity = 0;\n          for (let cartItem of cartArr) {\n            if (cartItem.foodId == foodItem.foodId) {\n              foodItem.quantity = cartItem.quantity;\n            }\n          }\n        }\n        this.foodArr.sort();\n      }).catch(error => {\n        console.error(error);\n      });\n    },\n    add(index) {\n      //首先做登录验证\n      if (this.user == null) {\n        this.$router.push({\n          path: '/login'\n        });\n        return;\n      }\n      if (this.foodArr[index].quantity == 0) {\n        //做insert\n        this.savaCart(index);\n      } else {\n        //做update\n        this.updateCart(index, 1);\n      }\n    },\n    minus(index) {\n      //首先做登录验证\n      if (this.user == null) {\n        this.$router.push({\n          path: '/login'\n        });\n        return;\n      }\n      if (this.foodArr[index].quantity > 1) {\n        //做update\n        this.updateCart(index, -1);\n      } else {\n        //做delete\n        this.removeCart(index);\n      }\n    },\n    savaCart(index) {\n      axios.post('CartController/saveCart', this.$qs.stringify({\n        businessId: this.businessId,\n        userId: this.user.userId,\n        foodId: this.foodArr[index].foodId\n      })).then(response => {\n        if (response.data == 1) {\n          //此食品数量要更新为1；\n          this.foodArr[index].quantity = 1;\n          this.foodArr.sort();\n        } else {\n          alert('向购物车中添加食品失败！');\n        }\n      }).catch(error => {\n        console.error(error);\n      });\n    },\n    updateCart(index, num) {\n      axios.post('CartController/updateCart', this.$qs.stringify({\n        businessId: this.businessId,\n        userId: this.user.userId,\n        foodId: this.foodArr[index].foodId,\n        quantity: this.foodArr[index].quantity + num\n      })).then(response => {\n        if (response.data == 1) {\n          //此食品数量要更新为1或-1；\n          this.foodArr[index].quantity += num;\n          this.foodArr.sort();\n        } else {\n          alert('向购物车中更新食品失败！');\n        }\n      }).catch(error => {\n        console.error(error);\n      });\n    },\n    removeCart(index) {\n      axios.post('CartController/removeCart', this.$qs.stringify({\n        businessId: this.businessId,\n        userId: this.user.userId,\n        foodId: this.foodArr[index].foodId\n      })).then(response => {\n        if (response.data == 1) {\n          //此食品数量要更新为0；视图的减号和数量要消失\n          this.foodArr[index].quantity = 0;\n          this.foodArr.sort();\n        } else {\n          alert('从购物车中删除食品失败！');\n        }\n      }).catch(error => {\n        console.error(error);\n      });\n    },\n    toOrder() {\n      this.$router.push({\n        path: '/orders',\n        query: {\n          businessId: this.business.businessId\n        }\n      });\n    }\n  },\n  computed: {\n    //食品总价格\n    totalPrice() {\n      let total = 0;\n      for (let item of this.foodArr) {\n        total += item.foodPrice * item.quantity;\n      }\n      return total;\n    },\n    //食品总数量\n    totalQuantity() {\n      let quantity = 0;\n      for (let item of this.foodArr) {\n        quantity += item.quantity;\n      }\n      return quantity;\n    },\n    //结算总价格\n    totalSettle() {\n      return this.totalPrice + this.business.deliveryPrice;\n    }\n  }\n}\n</script>\n<style scoped>\n/****************** 总容器 ******************/\n.wrapper {\n  width: 100%;\n  height: 100%;\n}\n/****************** header部分 ******************/\n.wrapper header {\n  width: 100%;\n  height: 12vw;\n  background-color: #0097FF;\n  color: #fff;\n  font-size: 4.8vw;\n  position: fixed;\n  left: 0;\n  top: 0;\n  z-index: 1000;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n/****************** 商家logo部分 ******************/\n.wrapper .business-logo {\n  width: 100%;\n  height: 35vw;\n  /*使用上外边距避开header部分*/\n  margin-top: 12vw;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.wrapper .business-logo img {\n  width: 40vw;\n  height: 30vw;\n  border-radius: 5px;\n}\n/****************** 商家信息部分 ******************/\n.wrapper .business-info {\n  width: 100%;\n  height: 20vw;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n}\n.wrapper .business-info h1 {\n  font-size: 5vw;\n}\n.wrapper .business-info p {\n  font-size: 3vw;\n  color: #666;\n  margin-top: 1vw;\n}\n/****************** 食品列表部分 ******************/\n.wrapper .food {\n  width: 100%;\n  /*使用下外边距避开footer部分*/\n  margin-bottom: 14vw;\n}\n.wrapper .food li {\n  width: 100%;\n  box-sizing: border-box;\n  padding: 2.5vw;\n  user-select: none;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.wrapper .food li .food-left {\n  display: flex;\n  align-items: center;\n}\n.wrapper .food li .food-left img {\n  width: 20vw;\n  height: 20vw;\n}\n.wrapper .food li .food-left .food-left-info {\n  margin-left: 3vw;\n}\n.wrapper .food li .food-left .food-left-info h3 {\n  font-size: 3.8vw;\n  color: #555;\n}\n.wrapper .food li .food-left .food-left-info p {\n  font-size: 3vw;\n  color: #888;\n  margin-top: 2vw;\n}\n.wrapper .food li .food-right {\n  width: 16vw;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.wrapper .food li .food-right .fa-minus-circle {\n  font-size: 5.5vw;\n  color: #999;\n  cursor: pointer;\n}\n.wrapper .food li .food-right p {\n  font-size: 3.6vw;\n  color: #333;\n}\n.wrapper .food li .food-right .fa-plus-circle {\n  font-size: 5.5vw;\n  color: #0097EF;\n  cursor: pointer;\n}\n/****************** 购物车部分 ******************/\n.wrapper .cart {\n  width: 100%;\n  height: 14vw;\n  position: fixed;\n  left: 0;\n  bottom: 0;\n  display: flex;\n}\n.wrapper .cart .cart-left {\n  flex: 2;\n  background-color: #505051;\n  display: flex;\n}\n.wrapper .cart .cart-left .cart-left-icon {\n  width: 16vw;\n  height: 16vw;\n  box-sizing: border-box;\n  border: solid 1.6vw #444;\n  border-radius: 8vw;\n  background-color: #3190E8;\n  font-size: 7vw;\n  color: #fff;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-top: -4vw;\n  margin-left: 3vw;\n  position: relative;\n}\n.wrapper .cart .cart-left .cart-left-icon-quantity {\n  width: 5vw;\n  height: 5vw;\n  border-radius: 2.5vw;\n  background-color: red;\n  color: #fff;\n  font-size: 3.6vw;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  position: absolute;\n  right: -1.5vw;\n  top: -1.5vw;\n}\n.wrapper .cart .cart-left .cart-left-info p:first-child {\n  font-size: 4.5vw;\n  color: #fff;\n  margin-top: 1vw;\n}\n.wrapper .cart .cart-left .cart-left-info p:last-child {\n  font-size: 2.8vw;\n  color: #AAA;\n}\n.wrapper .cart .cart-right {\n  flex: 1;\n}\n/*达到起送费时的样式*/\n.wrapper .cart .cart-right .cart-right-item {\n  width: 100%;\n  height: 100%;\n  background-color: #38CA73;\n  color: #fff;\n  font-size: 4.5vw;\n  font-weight: 700;\n  user-select: none;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n/*不够起送费时的样式（只有背景色和鼠标样式的区别）*/\n/*\n.wrapper .cart .cart-right .cart-right-item{\nwidth: 100%;\nheight: 100%;\nbackground-color: #535356;\ncolor: #fff;\nfont-size: 4.5vw;\nfont-weight: 700;\nuser-select: none;\n\ndisplay: flex;\njustify-content: center;\nalign-items: center;\n}\n*/\n</style>"]},"metadata":{},"sourceType":"module"}